<!DOCTYPE html>
<html lang="en" dir="ltr" style="text-align:center">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="A replication of the original oddball paradigm.">
  <meta name="keywords" content="HTML, CSS, JavaScript, jQuery, Cognition, Cognitive Science, Cognitive Psychology, Oddball Paradigm">
  <meta name="author" content="Nathan Liang, Shanmukh Aditya Upadhyayula">
  <link rel="shortcut icon" type="image/png" href="https://avatars0.githubusercontent.com/u/23708834?s=460&v=4" />
  <link rel="stylesheet" type="text/css" href="Oddball_Instructions.css">
  <title>Oddball Paradigm</title>
</head>

<body>
  <!-- Vision Sciences Group Logo -->
  <img src="https://static1.squarespace.com/static/53868534e4b03e5662d8336e/t/53a23905e4b0365dad7a353c/1403140386069/" alt="The Vision Sciences Group" width="800px" id="visionLogo">

  <!-- Vertically and horizontally entered intro block -->
  <div class="outer">
    <div class="middle">
      <div class="boxed">
        <h1><strong>Instructions</strong></h1>
        <!--|___________This is the width for the intro paragraph___________|-->
        <p id="p1">Welcome! Thank you for agreeing to participate in this study.
          Please read the following directions carefully before beginning.</p>
        <p id="p2">You will be presented with a series of regular black disks. These disks will be presented for a precisely equal duration on the screen. <br><br>
          Occasionally, you will also be presented with a variety of irregular disks.
          Your task is to judge whether each of these "oddball" disks appears on the screen for a longer
          or shorter amount of time than the regular disks.</p>
        <p id="p3">Once you've identified whether each oddball lasted longer or shorter than the regular disks,
          press [S] or [L] on the keyboard.</p>
        <p id="p4">Now, get ready! Place one finger on the [S] key and another on the [L] key on your keyboard.</p>
        <img src=https://media.apnarm.net.au/media/images/2017/06/12/twb120617zoo-feutriv2y5yr8dxbeo2_t460.JPG alt="llama!" height="180px" style="border-radius:50%" id="llamaPic">
        <p class="llamaText">If you're feeling like this guy at any point during the experiment, <br> you can press the [ESC] key to exit!</p>
        <button class="btn-hover color" id="regularButton">Continue â†’</button>
        <button class="btn-hover color-start" id="startButton" style="z-index:50;">Begin Experiment!</button>
        <img src=https://www.stickpng.com/assets/thumbs/5935b4213cdd5d2b9146e0db.png alt="typing hands" id="typingHands">
      </div>
    </div>
  </div>
  <!-- Mid-experiment reminder to make a duration choice -->
  <p id="p5" style="text-align:center;left:50%;top:50%;"> Press: <br> [S] = Shorter / [L] = Longer </p>

  <!-- Initialize stimuli -->
  <div id="std"></div>
  <div id="oddBall"></div>
  <div id="redBall"></div>
  <div id="spikeyBall"></div>

  <!-- Start of animation -->
  <script>
    $('#std').hide();
    $('#oddBall').hide();
    $('#redBall').hide();
    $('#spikeyBall').hide();

    // Randomized oddball disk duration array and Knuth shuffle
    function shuffle(array) {
      var currentIndex = array.length,
        temporaryValue, randomIndex;
      while (0 !== currentIndex) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
      }
      return array;
    }

    // Generates each experiment after looping through 54 oddballs, 7-12 standard disks and ending with 3 disks.
    function trialGenerator() {
      var trialInfo = [];
      var oddBag = [];
      var oddType = [];
      var oddBallDurations = [450, 525, 600, 675, 750, 825, 900, 975, 1050];
      var oddBallTypes = ['odd', 'spikey', 'red', 'odd', 'spikey', 'red', 'odd', 'spikey', 'red'];
      for (reps = 0; reps < 6; reps++) {
        oddBag = oddBag.concat(shuffle(oddBallDurations));
        oddType = oddType.concat(shuffle(oddBallTypes));
      }
      var oddBallIndex;
      for (oddBallIndex = 0; oddBallIndex < 54; oddBallIndex++) {
        var stdNumber = (Math.floor(Math.random() * (13 - 7)) + 7) /* Between 7-12 regular disks */ ;
        for (stdCount = 0; stdCount < stdNumber; stdCount++) {
          var isi = Math.floor(Math.random() * (1050 - 950) + 950);
          trialInfo.push({
            'type': 'std',
            'duration': 1050,
            'isi': isi,
            'judgment': null
          });
        }
        if (oddType[oddBallIndex] == 'odd') /* Looming black oddball */ {
          var isi = Math.floor(Math.random() * (1050 - 950) + 950);
          trialInfo.push({
            'type': 'odd',
            'duration': oddBag[oddBallIndex],
            'isi': isi,
            'judgment': null
          });
        } else if (oddType[oddBallIndex] == 'red') /* Stationary red oddball */ {
          var isi = Math.floor(Math.random() * (1050 - 950) + 950);
          trialInfo.push({
            'type': 'red',
            'duration': oddBag[oddBallIndex],
            'isi': isi,
            'judgment': null
          });

        } else /*Spiky oddball */ {
          var isi = Math.floor(Math.random() * (1050 - 950) + 950);
          trialInfo.push({
            'type': 'spikey',
            'duration': oddBag[oddBallIndex],
            'isi': isi,
            'judgment': null
          });
        }

      }
      var stdThree = 3;
      for (stdCount = 0; stdCount < stdThree; stdCount++) {
        var isi = Math.floor(Math.random() * (1050 - 950) + 950);
        trialInfo.push({
          'type': 'std',
          'duration': 1050,
          'isi': isi,
          'judgment': null
        });
      }
      trialInfo.push({
        'type': 'None',
        'duration': 'None',
        'isi': 'None',
        'judgment': 'None'
      });
      return trialInfo;
    }

    // The output of function trialGenerator()
    var frame = trialGenerator();
    var loop_active = true;
    var responseTimeStamp = 15;
    var counter = 0;

    // Standard disk toggling function
    $(document).keyup(function(e) {
      console.log(e.keyCode);
      if (e.keyCode == 83 || e.keyCode == 76 && !window.loop_active) {
        $("#p5").hide();
        window.loop_active = true;
        window.counter++;
        window.responseTimeStamp = 15 + window.counter;
        setTimeout(function() {
          ballAnimation(frame, window.counter);
        }, 0);
        console.log(window.frame[window.responseTimeStamp]);
        window.frame[window.responseTimeStamp]['judgment'] = e.keyCode;
      } else {}
    });
    var ballAnimation = function(frame, counter) {
      var frameWindow;
      if (window.counter < window.frame.length - 1) {
        frameWindow = frame[window.counter];
        if (frameWindow['type'] == 'std') {
          $('#oddBall').height(1);
          $('#oddBall').width(1);
          $('#oddBall').hide();
          $('#redBall').hide();
          $('#spikeyBall').hide();
          console.log(window.counter)
          console.log(window.responseTimeStamp)    
          if (window.counter < window.responseTimeStamp  && window.loop_active) {
            window.counter++;
            setTimeout(function() {
                $('#std').show();
                }, frameWindow['isi']);
            setTimeout(function() {
                $('#std').hide();
                }, frameWindow['isi'] + frameWindow['duration']);
            setTimeout(function() {
                ballAnimation(frame, window.counter);
                }, frameWindow['isi'] + frameWindow['duration'])
              

          } else {
            window.loop_active = false;
            $("#p5").fadeIn("2100");  
            
          }

        } else if (frameWindow['type'] == 'odd') {
          window.responseTimeStamp = window.counter;
          $('#std').hide();
          $('#oddBall').hide();
          $('#redBall').hide();
          $('#spikeyBall').hide();
          setTimeout(function() {
            $('#oddBall').show();
          }, frameWindow['isi']);
          var expansion = '250px';
          console.log(window.counter)
          console.log(window.responseTimeStamp)   
          $('#oddBall').animate({
            height: expansion,
            width: expansion
          }, frameWindow['isi'] + frameWindow['duration'], 'linear')
          setTimeout(function() {
            $('#oddBall').hide();
          }, frameWindow['isi'] + frameWindow['duration']);
          console.log($('#oddBall').height());
          window.counter++;
          setTimeout(function() {
            ballAnimation(frame, window.counter);
          }, frameWindow['isi'] + frameWindow['duration']);

        } else if (frameWindow['type'] == 'red') {
          window.responseTimeStamp = window.counter;
          console.log(window.counter)
          console.log(window.responseTimeStamp)   
          $('#std').hide();
          $('#oddBall').hide();
          $('#redBall').hide();
          $('#spikeyBall').hide();
          setTimeout(function() {
            $('#redBall').show();
          }, frameWindow['isi']);
          setTimeout(function() {
            $('#redBall').hide();
          }, frameWindow['isi'] + frameWindow['duration']);
          window.counter++;
          setTimeout(function() {
            ballAnimation(frame, window.counter);
          }, frameWindow['isi'] + frameWindow['duration'])

        } else if (frameWindow['type'] == 'spikey') {
          window.responseTimeStamp = window.counter;
          console.log(window.counter)
          console.log(window.responseTimeStamp)   
          $('#std').hide();
          $('#oddBall').hide();
          $('#redBall').hide();
          $('#spikeyBall').hide();
          setTimeout(function() {
            $('#std').show();
            $('#spikeyBall').show();
          }, frameWindow['isi']);
          setTimeout(function() {
            $('#std').hide();
            $('#spikeyBall').hide();
          }, frameWindow['isi'] + frameWindow['duration']);
          window.counter++;
          setTimeout(function() {
            ballAnimation(frame, window.counter);
          }, frameWindow['isi'] + frameWindow['duration'])
        }

      } else {
        $('#std').hide();
        $('#oddBall').hide();
        $('#redBall').hide();
        $('#spikeyBall').hide();
      }
    }

    // Carries out each experiment trial via animations from JQuery
    // trialInfo: [{type: 'std/odd', duration: 1050/offBag[oddBallIndex], isi: isi, judgment: null}]
    $("button").hide();
    $("#p1").show();
    $("#p2").hide();
    $("#p3").hide();
    $("#p4").hide();
    $("#p5").hide();
    $("#llamaPic").hide();
    $("#typingHands").hide()
    $(".llamaText").hide();
    setTimeout(function() {
      $("#regularButton").fadeIn("slow")
    }, 2500);
    $("#regularButton").click(function() {
      $("#regularButton").hide();
      $("#p1").hide();
      $("#p2").fadeIn("5000");
      setTimeout(function() {
        $("#regularButton").fadeIn("slow")
      }, 3000);
      $("#regularButton").click(function() {
        $("#regularButton").hide();
        $("#p2").hide();
        $("#p3").fadeIn("1500");
        setTimeout(function() {
          $("#regularButton").fadeIn("slow")
        }, 3000);
        $("#regularButton").click(function() {
          $("#regularButton").hide();
          $("#p3").remove();
          $(".boxed").css("height", "+=50");
          $(".llamaText").show();
          $("#llamaPic").show();
          setTimeout(function() {
            $("#regularButton").fadeIn("slow")
          }, 3000);
          $("#regularButton").click(function() {
            $("#p4").show();
            $(".boxed").css("height", "-=250");
            $(".llamaText").remove();
            $("#llamaPic").remove();
            $("#regularButton").remove();
            $("#typingHands").show();
            $("typingHands").slide();
            $(document).keyup(function() {
              $(".boxed").remove();
              $("img").remove();
              ballAnimation(frame, counter);
            })
          })
        })
      })
    })
  </script>
</body>

</html>
