<!DOCTYPE html>
<html lang="en" dir="ltr" style="text-align:center">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="A replication of the original oddball paradigm.">
  <meta name="keywords" content="HTML, CSS, JavaScript, JQuery, Cognition, CogSci, Cognitive Psychology">
  <meta name="author" content="Nathan Liang, Shanmukh Aditya Upadhyayula">
  <link rel="shortcut icon" type="image/png" href="https://avatars0.githubusercontent.com/u/23708834?s=460&v=4" />
  <link rel="stylesheet" type="text/css" href="Oddball_Instructions.css">
  <title>Oddball Paradigm</title>
</head>

<body>
  <img src="https://static1.squarespace.com/static/53868534e4b03e5662d8336e/t/53a23905e4b0365dad7a353c/1403140386069/" alt="The Vision Sciences Group" width="600px" style="border-radius:5%">
  <div class="boxed">
    <h1><strong>Instructions</strong></h1>
    <!--|___________This is the width for the intro paragraph___________|-->
    <p id="p1">Welcome! Thank you for agreeing to participate in this study.<br>
      Please read the following directions carefully before beginning the experiment.</p>
    <p id="p2">You will be presented with a series of regular black disks.
      These disks will occasionally be interrupted by oddball disks.
      Your task is to identify whether the duration for which each
      oddball disk is presented on the screen is longer
      or shorter than the duration of each regular disk.</p>
    <p id="p3">Once you've identified whether the oddball lasted longer or shorter,
      type (L) or (R) on the keyboard. Make sure to submit your response before the following three disks are presented.</p>

    <img src=https://media.apnarm.net.au/media/images/2017/06/12/twb120617zoo-feutriv2y5yr8dxbeo2_t460.JPG alt-"llama!" width="250px" style="border-radius: 50%" id="llamaPic">
    <p class="llamaText">If you're feeling like this guy at any point during the experiment, you can press the [ESC] key to exit!</p>

    <button class="btn-hover color" id="regularButton">Continue</button>
    <button class="btn-hover color-start" id="startButton">Begin Experiment</button>
  </div>


  <div id="std"></div>
  <div id="oddBall"></div>
  <div id="redBall"></div>
  <div id="spikeyBall"></div>

  <script>
    $('#std').hide();
    $('#oddBall').hide();
    $('#redBall').hide();
    $('#spikeyBall').hide();
    // Randomized oddball disk duration array and Knuth shuffle
    function shuffle(array) {
      var currentIndex = array.length,
        temporaryValue, randomIndex;
      while (0 !== currentIndex) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
      }
      return array;
    }

    // Generates each experiment after looping through 54 oddballs, 7-12 standard disks and ending with 3 disks.
    function trialGenerator() {
      var trialInfo = [];
      var oddBag = [];
      var oddBallDurations = [450, 525, 600, 675, 750, 825, 900, 975, 1050];
      for (reps = 0; reps < 6; reps++) {
        oddBag = oddBag.concat(shuffle(oddBallDurations));
      }
      var oddBallIndex;
      for (oddBallIndex = 0; oddBallIndex < 54; oddBallIndex++) {
        var stdNumber = (Math.floor(Math.random() * (13 - 7)) + 7);
        for (stdCount = 0; stdCount < stdNumber; stdCount++) {
          var isi = Math.floor(Math.random() * (1050 - 950) + 950);
          trialInfo.push({
            'type': 'std',
            'duration': 1050,
            'isi': isi,
            'judgment': null
          });
        }

        // var isi = Math.floor(Math.random() * (1050 - 950) + 950);
        // trialInfo.push({
        //   'type': 'odd',
        //   'duration': oddBag[oddBallIndex],
        //   'isi': isi,
        //   'judgment': null
        // });

        // var isi = Math.floor(Math.random() * (1050 - 950) + 950);
        // trialInfo.push({
        //   'type': 'redBall',
        //   'duration': oddBag[oddBallIndex],
        //   'isi': isi,
        //   'judgment': null
        // });

        var isi = Math.floor(Math.random() * (1050 - 950) + 950);
        trialInfo.push({
          'type': 'spikeyBall',
          'duration': oddBag[oddBallIndex],
          'isi': isi,
          'judgment': null
        });
      }
      var stdThree = 3;
      for (stdCount = 0; stdCount < stdThree; stdCount++) {
        var isi = Math.floor(Math.random() * (1050 - 950) + 950);
        trialInfo.push({
          'type': 'std',
          'duration': 1050,
          'isi': isi,
          'judgment': null
        });
      }
      trialInfo.push({
        'type': 'None',
        'duration': 'None',
        'isi': 'None',
        'judgement': 'None'
      });
      return trialInfo;
    }

    // The output of function trialGenerator()
    var frame = trialGenerator();

    // Standard disk toggling function

    var ballAnimation = function(frame, counter) {
      var frameWindow;
      if (counter < window.frame.length - 1) {
        frameWindow = frame[counter];

        if (frameWindow['type'] == 'std') {
          $('#oddBall').height(1);
          $('#oddBall').width(1);
          setTimeout(function() {
            $('#std').show();
          }, frameWindow['isi']);
          setTimeout(function() {
            $('#std').hide();
          }, frameWindow['isi'] + frameWindow['duration']);
          counter++;
          setTimeout(function() {
            ballAnimation(frame, counter);
          }, frameWindow['isi'] + frameWindow['duration'])

        } else if (frameWindow['type'] == 'oddBall') {
          setTimeout(function() {
            $('#oddBall').show();
          }, frameWindow['isi']);
          var expansion = '250px';
          console.log(expansion);
          $('#oddBall').animate({
            height: expansion,
            width: expansion
          }, frameWindow['isi'] + frameWindow['duration'], 'linear')
          setTimeout(function() {
            $('#oddBall').hide();
          }, frameWindow['isi'] + frameWindow['duration'])
          console.log($('#oddBall').height())
          counter++
          setTimeout(function() {
            ballAnimation(frame, counter);
          }, frameWindow['isi'] + frameWindow['duration'])

        } else if (frameWindow['type'] == 'redBall') {
          setTimeout(function() {
            $('#redBall').show();
          }, frameWindow['isi']);
          var expansion = '250px';
          console.log(expansion);
          $('#redBall').animate({
            height: expansion,
            width: expansion
          }, frameWindow['isi'] + frameWindow['duration'], 'linear')
          setTimeout(function() {
            $('#redBall').hide();
          }, frameWindow['isi'] + frameWindow['duration'])
          console.log($('#redBall').height())
          counter++
          setTimeout(function() {
            ballAnimation(frame, counter);
          }, frameWindow['isi'] + frameWindow['duration'])
        } else if (frameWindow['type'] == 'spikeyBall') {
          setTimeout(function() {
            $('#std').show();
            $('#spikeyBall').show();
          }, frameWindow['isi']);
          setTimeout(function() {
            $('#std').hide();
            $('#spikeyBall').hide();
          }, frameWindow['isi'] + frameWindow['duration'])
          counter++
          setTimeout(function() {
            ballAnimation(frame, counter);
          }, frameWindow['isi'] + frameWindow['duration'])
        }

      } else {
        $('#std').hide();
        // $('#oddBall').hide();
        // $('#redBall').hide();
        $('#spikeyBall').hide();
      }
    }

    // Carries out each experiment trial via animations from JQuery
    // trialInfo: [{type: 'std/odd', duration: 1050/offBag[oddBallIndex], isi: isi, judgment: null}]
    $("button").hide();
    $("#p1").show();
    $("#p2").hide();
    $("#p3").hide();
    $("#llamaPic").hide();
    $(".llamaText").hide();
    setTimeout(function() {
      $("#regularButton").fadeIn("slow")
    }, 2500);
    $("#regularButton").click(function() {
      $("#regularButton").hide();
      $("#p1").hide();
      $("#p2").fadeIn("5000");
      setTimeout(function() {
        $("#regularButton").fadeIn("slow")
      }, 3000);
      $("#regularButton").click(function() {
        $("#regularButton").hide();
        $("#p2").hide();
        $("#p3").fadeIn("1500");
        setTimeout(function() {
          $("#regularButton").fadeIn("slow")
        }, 3000);
        $("#regularButton").click(function() {
          $("#regularButton").remove();
          $("#p3").remove();
          $(".boxed").css("height", "+=150");
          $(".llamaText").show();
          $("#llamaPic").show();
          setTimeout(function() {
            $("#startButton").fadeIn("slow")
          }, 1000);
          $("#startButton").click(function() {
            $(".boxed").remove();
            $("img").remove();
            var counter = 0;
            ballAnimation(frame, counter);
          })
        })
      })
    })
  </script>
</body>

</html>
