<!DOCTYPE html>
<html lang="en" dir="ltr" style="text-align:center">
<!-- jQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>

<!-- ======================== TIMESTAMP ======================= -->
<script>
  var currentDate = new Date();
  var date = currentDate.getDate();
  var month = currentDate.getMonth();
  var year = currentDate.getFullYear();
  var dateString = date + "-" + (month + 1) + "-" + year;
</script>

<!-- ======================== METADATA ======================= -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="A replication of the original oddball paradigm.">
  <meta name="keywords" content="HTML, CSS, JavaScript, jQuery, Cognition, Cognitive Science, Cognitive Psychology, Oddball Paradigm">
  <meta name="author" content="Nathan Liang, Shanmukh Aditya Upadhyayula">
  <link rel="shortcut icon" type="image/png" href="https://avatars0.githubusercontent.com/u/23708834?s=460&v=4" />
  <link rel="stylesheet" type="text/css" href="Oddball_Instructions.css">
  <title>Oddball Paradigm</title>
</head>

<!-- ======================== INTRODUCTION ======================= -->
<body>
  <!-- Vision Sciences Group Logo -->
  <img src="https://static1.squarespace.com/static/53868534e4b03e5662d8336e/t/53a23905e4b0365dad7a353c/1403140386069/" alt="The Vision Sciences Group" width="800px" id="visionLogo">

  <!-- Vertically and horizontally entered intro block wrapper -->
  <div class="outer">
    <div class="middle">
      <div class="boxed">
        <h1><strong>Instructions</strong></h1>
        <p id="p1">Welcome! Thank you for agreeing to participate in this study.
          Please read the following directions carefully before beginning.</p>
        <p id="p2">In this experiment, we will be testing your ability to perceive duration,
          how long something lasts on the screen. The task is simple: You will see black disks flash on and off.
          The black disks will all last for exactly the same amount of time.
          Occasionally, you will see things other than a black disk appear and disappear
          — these might be spinning or differently colored things. </p>
        <p id="p3">
          All you need to do is judge whether that 'oddball' — the thing that is not a black disk
          — lasted longer or shorter on the screen than than the black disks.</p>
        <p id="p4">After seeing each oddball, you will be prompted to press the [S] key
          if you think the oddball lasted shorter than the black disks,
          or the [L] key if you think it lasted longer. <br> <br> Now, get ready! Press F11
          to make your viewport into fullscreen mode, then place one finger on the [S] key and another on the
          [L] key on your keyboard. Be aware that your mouse cursor will disappear on the screen
          for the duration of the experiment to prevent distraction!</p>
        <form action="/action_page.php" id="workerID">
          Please enter your mTurk Worker ID below:
          <br><br>
          <input type="text" name="mTurkWorkerID">
          <br><br>
          <input type="submit" value="Submit" id="submit">
        </form>
        <button class="btn-hover color" id="regularButton">Continue →</button>
        <button class="btn-hover color-start" id="startButton">Begin Experiment!</button>
      </div>
    </div>
  </div>

  <!-- Mid-experiment reminder to make a duration choice -->
  <div id="p5">
    <p> <strong>Press:</strong> <br> [S] = Shorter <br> [L] = Longer </p>
  </div>


  <!-- Questions/comments entry space -->
  <div id="qc">
    <p> <strong>Press:</strong> <br> [S] = Shorter <br> [L] = Longer </p>
  </div>

  <!-- Debrief form -->
  <div id="debrief">
    <h1> <strong>Debriefing Form</strong></h1>
    
    Protocol #: Title (match the protocol number and title on iProtocol)

Thank you for agreeing to participate in this study!  The general purpose of this research is explain the basic constructs of the study.  Make sure that you write the information so that the participant can understand it.

We invited people who describe the selection criteria.  The experimenter does not know whether you were in the low or high anxiety group (for example).  In this study, you were asked to describe what the participant did and describe how this relates to the purpose/ thesis of the study. The results from this study will provide a description of what you hope to accomplish with the study.

If you feel especially concerned about describe potential concerns that may occur, please feel free to phone provide researcher/ lab contact info about options for counseling.  Alternatively, you could also phone the UVA Counseling and Psychological Services (434-243-5556) or the Mary D. Ainsworth Psychological Clinic in the psychology department (434-982-4737) (provide alternative contacts if participants may need additional help).

Thank you for your participation in this study.  If you have further questions about the study, please contact researcher contact information.  In addition, if you have any concerns about any aspect of the study, you may contact Tonya Moon, Ph.D., Chair, Institutional Review Board for the Social and Behavioral Sciences, One Morton Drive, Suite 500, University of Virginia, P.O. Box 800392, Charlottesville, VA 22908-0392. Telephone: (434) 924-5999.
Email: irbsbshelp@virginia.edu
Website: www.virginia.edu/vpr/irb/sbs



Additional Reading:

Provide two references (text, article, on-line reference, etc.) that can be easily accessed by the targeted population in this study. If you have academic and non-academic participants, you should create either two debriefing forms or provide references that are easily accessible to the non-academic population.

  </div>
  <!-- ======================== STIMULI ======================= -->
  <div id="std"></div>
  <div id="oddBall"></div>
  <div id="redBall"></div>
  <div id="spikeyBall"></div>

  <!-- ======================== ANIMATIONS ======================= -->
  <script>
    $('#std').hide();
    $('#oddBall').hide();
    $('#redBall').hide();
    $('#spikeyBall').hide();

    // ======================== FISHER-YATES/KNUTH SHUFFLE ======================= //
    // Randomized oddball disk duration array and Knuth shuffle
    function shuffle(array) {
      var currentIndex = array.length,
        temporaryValue, randomIndex;
      while (0 !== currentIndex) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
      }
      return array;
    }

    // ======================== GET BROWSER ======================= //
    // Get browser (credit to Nimesh and other users of StackOverflow)
    function getBrowser() {
      if ((navigator.userAgent.indexOf("Opera") || navigator.userAgent.indexOf("OPR")) != -1) {
        return "Opera";
      } else if (navigator.userAgent.indexOf("Chrome") != -1) {
        return "Chrome";
      } else if (navigator.userAgent.indexOf("Safari") != -1) {
        return "Safari";
      } else if (navigator.userAgent.indexOf("Firefox") != -1) {
        browser = "Firefox";
      } else if ((navigator.userAgent.indexOf("MSIE") != -1) || (!!document.documentMode == true)) {
        // If IE > 10
        return "IE";
      } else {
        return "Unknown";
      }
    }

    // ======================== GET SUBJECT ID ======================== //
    // Get inferred subject ID from URL (credit to Eyal Peer)
    function getSubjectID() {
      var paramstr = window.location.search.substring(1);
      var parampairs = paramstr.split("&");
      for (i in parampairs) {
        var pair = parampairs[i].split("=");
        if (pair[0] == "workerId")
          return pair[1];
      }
    }

    // ======================== TRIAL GENERATOR ======================= //
    // Generates each experiment after looping through 54 oddballs, 7-12 standard disks and ending with 3 disks.
    function trialGenerator() {
      var trialInfo = [];
      var oddBag = [];
      var oddType = [];
      var oddBallDurations = [450, 525, 600, 675, 750, 825, 900, 975, 1050];
      var oddBallTypes = ['odd', 'spikey', 'red', 'odd', 'spikey', 'red', 'odd', 'spikey', 'red'];
      var nreps = 3;
      for (reps = 0; reps < nreps; reps++) {
        oddBag = oddBag.concat(shuffle(oddBallDurations));
        oddType = oddType.concat(shuffle(oddBallTypes));
      }
      var oddBallIndex;
      for (oddBallIndex = 0; oddBallIndex < 9 * nreps; oddBallIndex++) {
        var stdNumber = (Math.floor(Math.random() * (13 - 7)) + 7); // Between 7-12 regular disks
        for (stdCount = 0; stdCount < stdNumber; stdCount++) {
          var isi = Math.floor(Math.random() * (1050 - 950) + 950);
          trialInfo.push({
            'type': 'std',
            'duration': 1050,
            'isi': isi,
            'judgment': 'null',
            'browser': window.browser,
            'subjectID': window.subjectID
          });
        }
        if (oddType[oddBallIndex] == 'odd') {
          // Looming black oddball
          var isi = Math.floor(Math.random() * (1050 - 950) + 950);
          trialInfo.push({
            'type': 'odd',
            'duration': oddBag[oddBallIndex],
            'isi': isi,
            'judgment': 'null',
            'browser': window.browser,
            'subjectID': window.subjectID
          });
        } else if (oddType[oddBallIndex] == 'red') {
          // Stationary red oddball
          var isi = Math.floor(Math.random() * (1050 - 950) + 950);
          trialInfo.push({
            'type': 'red',
            'duration': oddBag[oddBallIndex],
            'isi': isi,
            'judgment': 'null',
            'browser': window.browser,
            'subjectID': window.subjectID
          });
        } else {
          // Spiky oddball
          var isi = Math.floor(Math.random() * (1050 - 950) + 950);
          trialInfo.push({
            'type': 'spikey',
            'duration': oddBag[oddBallIndex],
            'isi': isi,
            'judgment': 'null',
            'browser': window.browser,
            'subjectID': window.subjectID
          });
        }
      }
      return trialInfo;
    }

    // ======================== TRIAL GENERATION ======================= //
    var browser = getBrowser();
    var subjectID = 'Adi' //Replace it with getSubjectID() later
    var frame = trialGenerator();
    var loop_active = true;
    var responseTimeStamp = 15;
    var counter = 0;

    // ======================== TRIAL GENERATION RUN ======================= //
    // Standard disk toggling function
    $(document).keyup(function(e) {
      console.log(e.keyCode);
      if ((e.keyCode == 83 || e.keyCode == 76) && !window.loop_active) {
        $("#p5").hide();
        window.loop_active = true;
        window.counter++;
        setTimeout(function() {
          ballAnimation(frame, window.counter);
        }, 0);
        console.log(window.frame[window.responseTimeStamp]);
        window.frame[window.responseTimeStamp]['judgment'] = e.keyCode;
        window.responseTimeStamp = 15 + window.counter;
      } else if (e.keyCode == 83 || e.keyCode == 76) {
        $("#p5").hide();
      } else {}
    });
    var ballAnimation = function(frame, counter) {
      var frameWindow;
      if (window.counter < window.frame.length - 1) {
        frameWindow = frame[window.counter];
        if (frameWindow['type'] == 'std') {
          $('#oddBall').height(1);
          $('#oddBall').width(1);
          $('#oddBall').hide();
          $('#redBall').hide();
          $('#spikeyBall').hide();
          console.log(window.counter)
          console.log(window.responseTimeStamp)
          if (window.counter < window.responseTimeStamp && window.loop_active) {
            window.counter++;
            setTimeout(function() {
              $('#std').show();
            }, frameWindow['isi']);
            setTimeout(function() {
              $('#std').hide();
            }, frameWindow['isi'] + frameWindow['duration']);
            setTimeout(function() {
              ballAnimation(frame, window.counter);
            }, frameWindow['isi'] + frameWindow['duration'])
          } else {
            window.loop_active = false;
            setTimeout(function() {
              $("#p5").show();
            }, 1050);
          }
        } else if (frameWindow['type'] == 'odd') {
          window.responseTimeStamp = window.counter;
          $('#std').hide();
          $('#oddBall').hide();
          $('#redBall').hide();
          $('#spikeyBall').hide();
          setTimeout(function() {
            $('#oddBall').show();
          }, frameWindow['isi']);
          var expansion = '250px';
          console.log(window.counter)
          console.log(window.responseTimeStamp)
          $('#oddBall').animate({
            height: expansion,
            width: expansion
          }, frameWindow['isi'] + frameWindow['duration'], 'linear')
          setTimeout(function() {
            $('#oddBall').hide();
          }, frameWindow['isi'] + frameWindow['duration']);
          console.log($('#oddBall').height());
          window.counter++;
          setTimeout(function() {
            ballAnimation(frame, window.counter);
          }, frameWindow['isi'] + frameWindow['duration']);
        } else if (frameWindow['type'] == 'red') {
          window.responseTimeStamp = window.counter;
          console.log(window.counter)
          console.log(window.responseTimeStamp)
          $('#std').hide();
          $('#oddBall').hide();
          $('#redBall').hide();
          $('#spikeyBall').hide();
          setTimeout(function() {
            $('#redBall').show();
          }, frameWindow['isi']);
          setTimeout(function() {
            $('#redBall').hide();
          }, frameWindow['isi'] + frameWindow['duration']);
          window.counter++;
          setTimeout(function() {
            ballAnimation(frame, window.counter);
          }, frameWindow['isi'] + frameWindow['duration'])
        } else if (frameWindow['type'] == 'spikey') {
          window.responseTimeStamp = window.counter;
          console.log(window.counter)
          console.log(window.responseTimeStamp)
          $('#std').hide();
          $('#oddBall').hide();
          $('#redBall').hide();
          $('#spikeyBall').hide();
          setTimeout(function() {
            $('#std').show();
            $('#spikeyBall').show();
          }, frameWindow['isi']);
          setTimeout(function() {
            $('#std').hide();
            $('#spikeyBall').hide();
          }, frameWindow['isi'] + frameWindow['duration']);
          window.counter++;
          setTimeout(function() {
            ballAnimation(frame, window.counter);
          }, frameWindow['isi'] + frameWindow['duration'])
        }
      } else {
        $('#std').hide();
        $('#oddBall').hide();
        $('#redBall').hide();
        $('#spikeyBall').hide();
        // Collect responses into JSON / csv file
        var dataString = JSON.stringify(window.frame);
        // post response to server
        $.post("logTrial.py", {
          subjectID: window.subjectID,
          dataString: dataString
        });

        // Questions Comments
        $("#qc").show();

        // Debriefing
        $("#debrief").show();



        // Random Code Generation
        $("#randCode").show()
      }
    }

    // ======================== MAIN BLOCK ======================= //
    // Carries out each experiment trial via animations
    $("#workerID").hide();
    $("button").hide();
    $("#p1").show();
    $("#p2").hide();
    $("#p3").hide();
    $("#p4").hide();
    $("#p5").hide();
    setTimeout(function() {
      $("#regularButton").fadeIn("slow")
    }, 1750);
    $("#regularButton").click(function() {
      $("#regularButton").hide();
      $("#p1").hide();
      $("#p2").fadeIn("5000");
      setTimeout(function() {
        $("#regularButton").fadeIn("slow")
      }, 3000);
      $("#regularButton").click(function() {
        $("#regularButton").hide();
        $("#p2").hide();
        $("#p3").fadeIn("1500");
        setTimeout(function() {
          $("#regularButton").fadeIn("slow")
        }, 2000);
        $("#regularButton").click(function() {
          $("#regularButton").show();
          $("#p3").remove();
          $("#p4").fadeIn("1500");
          setTimeout(function() {
            $("#regularButton").fadeIn("slow")
          }, 2000);
          $("#regularButton").click(function() {
            $(".boxed").css("height", "+=50");
            $("#regularButton").remove();
            $("p4").hide();
            $("#workerID").show();
            $("#submit").click(function() {
              $("#startButton").click(function() {
                $("img").remove();
                $(".outer").remove();
                $("html").css({"cursor": "none"})
                ballAnimation(frame, counter);
                $("html").css({"cursor": "default"})
              })
            })
          })
        })
      })
    })
  </script>
</body>

</html>
<!-- NATHAN: Make random ID, make input box for mTurk ID, Cursor hide and inform them, debrief, random code submission generator -->
